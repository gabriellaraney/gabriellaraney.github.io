<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cute Economic Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>ðŸ“Š Cute Economic Dashboard</header>

  <div class="container" id="data-container">
    <!-- FRED Economic Indicators -->
    <div class="card">
      <h2>GDP (USA)</h2>
      <p id="gdp" class="value">Loading...</p>
      <canvas id="gdpChart"></canvas>
    </div>
    <div class="card">
      <h2>Unemployment (USA)</h2>
      <p id="unrate" class="value">Loading...</p>
      <canvas id="unrateChart"></canvas>
    </div>
    <div class="card">
      <h2>CPI (USA)</h2>
      <p id="cpi" class="value">Loading...</p>
      <canvas id="cpiChart"></canvas>
    </div>
    <div class="card">
      <h2>10Y Treasury Yield</h2>
      <p id="gs10" class="value">Loading...</p>
      <canvas id="gs10Chart"></canvas>
    </div>
    <div class="card">
      <h2>5Y Inflation Expectation</h2>
      <p id="t5yie" class="value">Loading...</p>
      <canvas id="t5yieChart"></canvas>
    </div>

    <!-- U.S. Indexes -->
    <div class="card">
      <h2>S&P 500 (SPY)</h2>
      <p id="sp500" class="value">Loading...</p>
      <canvas id="sp500Chart"></canvas>
    </div>
    <div class="card">
      <h2>Dow Jones (DIA)</h2>
      <p id="dji" class="value">Loading...</p>
      <canvas id="djiChart"></canvas>
    </div>
    <div class="card">
      <h2>Nasdaq (QQQ)</h2>
      <p id="ixic" class="value">Loading...</p>
      <canvas id="ixicChart"></canvas>
    </div>
    <div class="card">
      <h2>Russell 2000 (IWM)</h2>
      <p id="rut" class="value">Loading...</p>
      <canvas id="rutChart"></canvas>
    </div>

    <!-- Global Indexes -->
    <div class="card">
      <h2>FTSE 100 ðŸ‡¬ðŸ‡§ (EWU)</h2>
      <p id="ftse" class="value">Loading...</p>
      <canvas id="ftseChart"></canvas>
    </div>
    <div class="card">
      <h2>Nikkei 225 ðŸ‡¯ðŸ‡µ (EWJ)</h2>
      <p id="n225" class="value">Loading...</p>
      <canvas id="n225Chart"></canvas>
    </div>
    <div class="card">
      <h2>DAX ðŸ‡©ðŸ‡ª (EWG)</h2>
      <p id="gdaxi" class="value">Loading...</p>
      <canvas id="gdaxiChart"></canvas>
    </div>
    <div class="card">
      <h2>Hang Seng ðŸ‡­ðŸ‡° (EWH)</h2>
      <p id="hsi" class="value">Loading...</p>
      <canvas id="hsiChart"></canvas>
    </div>
    <div class="card">
      <h2>China ðŸ‡¨ðŸ‡³ (MCHI)</h2>
      <p id="shcomp" class="value">Loading...</p>
      <canvas id="shcompChart"></canvas>
    </div>
  </div>

  <script>
    const FRED_API_KEY = "c5d6f351f39d10c302ebc99648038d4a";
    const ALPHA_KEY = "6OHNKZTCLXM3OZKW";

    // --- FRED Data ---
    async function fetchFRED(seriesId, elementId, chartId) {
      try {
        const url = `https://api.stlouisfed.org/fred/series/observations?series_id=${seriesId}&api_key=${FRED_API_KEY}&file_type=json`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Network response not ok");
        const data = await res.json();

        if (!data.observations) {
          document.getElementById(elementId).innerText = "No data";
          return;
        }

        const observations = data.observations
          .filter(o => o.value !== "." && !isNaN(parseFloat(o.value)));

        if (observations.length === 0) {
          document.getElementById(elementId).innerText = "No valid data";
          return;
        }

        const lastObs = observations[observations.length - 1];
        const lastValue = parseFloat(lastObs.value);
        document.getElementById(elementId).innerText = lastValue.toFixed(2);

        const recent = observations.slice(-20);
        const labels = recent.map(o => o.date);
        const values = recent.map(o => parseFloat(o.value));

        new Chart(document.getElementById(chartId), {
          type: "line",
          data: {
            labels: labels,
            datasets: [{
              label: seriesId,
              data: values,
              borderColor: "#cc0066",
              fill: false,
              tension: 0.2
            }]
          },
          options: { scales: { x: { display: false } } }
        });
      } catch (err) {
        console.error("FRED error for", seriesId, err);
        document.getElementById(elementId).innerText = "Error";
      }
    }

    // --- Alpha Vantage Data ---
    async function fetchAlpha(symbol, elementId, chartId) {
      try {
        const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${ALPHA_KEY}`;
        const res = await fetch(url);
        const data = await res.json();
        const series = data["Time Series (Daily)"];
        if (!series) {
          document.getElementById(elementId).innerText = "Error";
          return;
        }

        const allDates = Object.keys(series).sort(); // ascending
        const yearStart = new Date(new Date().getFullYear(), 0, 1);
        const ytdDates = allDates.filter(d => new Date(d) >= yearStart);

        if (ytdDates.length === 0) {
          document.getElementById(elementId).innerText = "No YTD data";
          return;
        }

        const values = ytdDates.map(date => parseFloat(series[date]["4. close"]));
        const labels = ytdDates;

        const firstValue = values[0];
        const lastValue = values[values.length - 1];
        const pctChange = ((lastValue - firstValue) / firstValue) * 100;

        document.getElementById(elementId).innerHTML =
          `<span style="color:${pctChange >= 0 ? 'green' : 'red'};">
            ${pctChange.toFixed(2)}% YTD
          </span><br>${lastValue.toFixed(2)}`;

        new Chart(document.getElementById(chartId), {
          type: "line",
          data: {
            labels: labels,
            datasets: [{
              label: symbol,
              data: values,
              borderColor: "#ff3399",
              fill: false,
              tension: 0.2
            }]
          },
          options: { scales: { x: { display: false } } }
        });
      } catch (err) {
        console.error("Alpha error for", symbol, err);
        document.getElementById(elementId).innerText = "Error";
      }
    }

    // --- Load FRED Indicators ---
    fetchFRED("GDP", "gdp", "gdpChart");
    fetchFRED("UNRATE", "unrate", "unrateChart");
    fetchFRED("CPIAUCSL", "cpi", "cpiChart");
    fetchFRED("GS10", "gs10", "gs10Chart");
    fetchFRED("T5YIE", "t5yie", "t5yieChart");

    // --- Load U.S. Indexes ---
    fetchAlpha("SPY", "sp500", "sp500Chart");   // S&P 500
    fetchAlpha("DIA", "dji", "djiChart");       // Dow
    fetchAlpha("QQQ", "ixic", "ixicChart");     // Nasdaq
    fetchAlpha("IWM", "rut", "rutChart");       // Russell 2000

    // --- Load Global Indexes ---
    fetchAlpha("EWU", "ftse", "ftseChart");     // UK FTSE
    fetchAlpha("EWJ", "n225", "n225Chart");     // Japan Nikkei
    fetchAlpha("EWG", "gdaxi", "gdaxiChart");   // Germany DAX
    fetchAlpha("EWH", "hsi", "hsiChart");       // Hong Kong Hang Seng
    fetchAlpha("MCHI", "shcomp", "shcompChart");// China
  </script>
</body>
</html>
