<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Economic Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    Economic Dashboard
    <div id="lastUpdated" style="font-size:0.9rem; font-weight:normal;"></div>
  </header>

  <!-- Macroeconomic Data -->
  <h2 class="section-header">Macroeconomic Data</h2>
  <h3 class="sub-header">Growth & Inflation</h3>
  <div class="container">
    <div class="card">
      <h2>GDP (US)</h2>
      <span class="ticker">[GDP]</span>
      <p id="gdp" class="value">Loading...</p>
      <canvas id="gdpChart"></canvas>
    </div>
    <div class="card">
      <h2>Unemployment (US)</h2>
      <span class="ticker">[UNRATE]</span>
      <p id="unrate" class="value">Loading...</p>
      <canvas id="unrateChart"></canvas>
    </div>
    <div class="card">
      <h2>CPI Inflation YoY (US)</h2>
      <span class="ticker">[CPIAUCSL]</span>
      <p id="cpi" class="value">Loading...</p>
      <canvas id="cpiChart"></canvas>
    </div>
    <div class="card">
      <h2>PCE Inflation YoY (US)</h2>
      <span class="ticker">[PCEPI]</span>
      <p id="pce" class="value">Loading...</p>
      <canvas id="pceChart"></canvas>
    </div>
    <div class="card">
      <h2>PPI Inflation YoY (US)</h2>
      <span class="ticker">[PPIACO]</span>
      <p id="ppi" class="value">Loading...</p>
      <canvas id="ppiChart"></canvas>
    </div>
  </div>

  <h3 class="sub-header">Macroeconomic Data â€“ Rates & Expectations</h3>
  <div class="container">
    <div class="card">
      <h2>SOFR (US)</h2>
      <span class="ticker">[SOFR]</span>
      <p id="sofr" class="value">Loading...</p>
      <canvas id="sofrChart"></canvas>
    </div>
    <div class="card">
      <h2>Fed Funds Rate (US)</h2>
      <span class="ticker">[FEDFUNDS]</span>
      <p id="fedfunds" class="value">Loading...</p>
      <canvas id="fedfundsChart"></canvas>
    </div>
    <div class="card">
      <h2>10Y Treasury Yield (US)</h2>
      <span class="ticker">[^TNX]</span>
      <p id="gs10" class="value">Loading...</p>
      <canvas id="gs10Chart"></canvas>
    </div>
    <div class="card">
      <h2>5Y Breakeven Inflation Expectation (US)</h2>
      <span class="ticker">[T5YIE]</span>
      <p id="t5yie" class="value">Loading...</p>
      <canvas id="t5yieChart"></canvas>
    </div>
  </div>

  <!-- Market Indexes -->
  <h2 class="section-header">Market Indexes</h2>
  <h3 class="sub-header">US Indexes</h3>
  <div class="container">
    <div class="card">
      <h2>S&P 500</h2>
      <span class="ticker">[^GSPC]</span>
      <p id="sp500" class="value">Loading...</p>
      <canvas id="sp500Chart"></canvas>
    </div>
    <div class="card">
      <h2>Dow Jones</h2>
      <span class="ticker">[^DJI]</span>
      <p id="dji" class="value">Loading...</p>
      <canvas id="djiChart"></canvas>
    </div>
    <div class="card">
      <h2>Nasdaq</h2>
      <span class="ticker">[^IXIC]</span>
      <p id="ixic" class="value">Loading...</p>
      <canvas id="ixicChart"></canvas>
    </div>
    <div class="card">
      <h2>Russell 2000</h2>
      <span class="ticker">[^RUT]</span>
      <p id="rut" class="value">Loading...</p>
      <canvas id="rutChart"></canvas>
    </div>
  </div>

  <h3 class="sub-header">Global Indexes</h3>
  <div class="container">
    <div class="card">
      <h2>FTSE 100 (UK)</h2>
      <span class="ticker">[^FTSE]</span>
      <p id="ftse" class="value">Loading...</p>
      <canvas id="ftseChart"></canvas>
    </div>
    <div class="card">
      <h2>Nikkei 225 (Japan)</h2>
      <span class="ticker">[^N225]</span>
      <p id="n225" class="value">Loading...</p>
      <canvas id="n225Chart"></canvas>
    </div>
    <div class="card">
      <h2>DAX (Germany)</h2>
      <span class="ticker">[^GDAXI]</span>
      <p id="gdaxi" class="value">Loading...</p>
      <canvas id="gdaxiChart"></canvas>
    </div>
    <div class="card">
      <h2>Hang Seng (Hong Kong)</h2>
      <span class="ticker">[^HSI]</span>
      <p id="hsi" class="value">Loading...</p>
      <canvas id="hsiChart"></canvas>
    </div>
    <div class="card">
      <h2>Shanghai Composite (China)</h2>
      <span class="ticker">[000001.SS]</span>
      <p id="shcomp" class="value">Loading...</p>
      <canvas id="shcompChart"></canvas>
    </div>
  </div>

  <script>
    document.getElementById("lastUpdated").innerText =
      "Last updated: " + new Date().toLocaleString();

    function formatNumber(value, type="number") {
      if (value == null || isNaN(value)) return "N/A";
      switch (type) {
        case "money": return `$${(value/1000).toFixed(5)}T`;
        case "percent": return value.toFixed(5) + "%";
        case "index": return value.toLocaleString(undefined, { minimumFractionDigits: 5, maximumFractionDigits: 5 });
        default: return value.toFixed(5);
      }
    }

    async function fetchBackend(symbol, elementId, chartId, options = {}) {
      const { displayType="index", showYTD=true } = options;
      try {
        const url = `https://economic-dashboard-backend.onrender.com/quote/${encodeURIComponent(symbol)}`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.error) throw new Error(data.error);

        const prices = data.history.values;
        const dates = data.history.dates;
        const firstVal = prices[0], lastVal = prices[prices.length - 1];

        if (showYTD) {
          const pctChange = ((lastVal - firstVal) / firstVal) * 100;
          document.getElementById(elementId).innerHTML =
            `<span style="color:${pctChange >= 0 ? 'green' : 'red'};">
              ${pctChange.toFixed(5)}% YTD
            </span><br>${formatNumber(lastVal, displayType)}`;
        } else {
          document.getElementById(elementId).innerText = formatNumber(lastVal, displayType);
        }

        new Chart(document.getElementById(chartId), {
          type: "line",
          data: {
            labels: dates,
            datasets: [{ data: prices, borderColor: "#ff3399", fill: false, tension: 0.2 }]
          },
          options: {
            plugins: { legend: { display: false } },
            scales: {
              x: {
                display: true,
                ticks: { autoSkip: true, maxTicksLimit: 6, maxRotation: 45, minRotation: 45 }
              }
            }
          }
        });
      } catch (err) {
        console.error("Backend error", symbol, err);
        document.getElementById(elementId).innerText = "Error";
      }
    }

    // US Indexes
    fetchBackend("^GSPC", "sp500", "sp500Chart");
    fetchBackend("^DJI", "dji", "djiChart");
    fetchBackend("^IXIC", "ixic", "ixicChart");
    fetchBackend("^RUT", "rut", "rutChart");

    // Global Indexes
    fetchBackend("^FTSE", "ftse", "ftseChart");
    fetchBackend("^N225", "n225", "n225Chart");
    fetchBackend("^GDAXI","gdaxi","gdaxiChart");
    fetchBackend("^HSI", "hsi", "hsiChart");
    fetchBackend("000001.SS","shcomp","shcompChart");
  </script>
</body>
</html>
